{% extends "global/Page.html" %}

{% block title %}
    FACTORY INFORMATION
{% endblock %}

{% block content %}

<style>
     .content-box {
        border: 1px solid #ccc;
        padding: 10px;
        background-color: #f9f9f9;
    }
</style>

<div class="content-box">
    <p>
        You now have <b style="color: red">3 minutes</b> to review the information below.
    </p>
    <p>
        Dear <strong>{{ role }}</strong>, only you possess the information below, so it is essential that you share it with the rest of the team to achieve an optimal decision for the company. Make sure to <strong>pay close attention and remember the details</strong>, as the information will not be repeated later.
    <p/>

    <h2>Project Descriptions</h2>

    <p>Your company is planning to <strong>expand its production capacity</strong> by building a new manufacturing facility. Please decide on the site that is expected to be most beneficial for the company in the long run.</p>

    <p>Here’s a brief overview of the two location alternatives:<p>

    <div class="project-description">
        <h3>Factory A: Steel Plant in the United States</h3>
        <p>This option proposes building a high-tech steel manufacturing facility in the Midwest region of the United States. The location offers proximity to skilled labor and political stability, opposing stricter construction regulations and higher wages.
            The estimated <strong>construction cost</strong> is <strong>280 million €</strong>.
            {% if role == 'Chief Marketing Officer' %} The expected <strong>annual energy cost</strong> is <strong>55 million €</strong>. </p>
            {% endif %}
    </div>

<div class="project-description">
    <h3>Factory B: Steel Plant in China</h3>
    <p>This project involves opening a new steel plant in China’s coastal industrial region. The location benefits from lower labor costs, relaxed construction regulations, and direct access to export markets.
        {% if role == 'Chief Financial Officer' %} The estimated <strong>construction cost</strong> is <strong>190 million €</strong>.
        {% elif role == 'Chief Human Resources Officer' %} The expected <strong>annual energy cost</strong> is <strong>50 million €</strong>. </p>
        {% endif %}
    </div>

    <h2>Decision Task</h2>
    <p>Remember, the project with the highest total attribute scores is considered the optimal choice for the company. Please also consider that for some dimensions, higher attribute scores may relate to lower given values (e.g. costs).</p>

    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #e2e2e2;
        }
    </style>

    <p>Take a moment to review the project details. This information will be essential for your upcoming discussion with the team.</p>

    <p>Once you feel prepared, click the next button below to proceed to the next step.</p>
</div>

<br/><br/>

<!-- Logging fields -->
<!-- Logging fields -->
<input type="hidden" name="task_load_time_project" id="task_load_time_project" value=""/>
<input type="hidden" name="task_finish_click_time_project" id="task_finish_click_time_project" value=""/>
<input type="hidden" name="task_end_time_project" id="task_end_time_project" value=""/>

<!-- Timeout message -->
<div class="text-center mt-3" id="warning-message" style="display: none; color: darkorange; font-weight: bold;">
    You have 1 minute left!
</div>

<!-- Next Button -->
<div class="d-flex justify-content-center mt-4">
    <button id="nextbtn" class="otree-btn-next btn btn-primary next-button otree-next-button">Next</button>
</div>

<!-- Waiting message -->
<div class="text-center mt-3" id="waiting-message" style="display: none;">
    Waiting for the other participants...
</div>

<script>
    const taskDuration = {{ taskDuration }} * 1000;
    const warningTime = 60 * 1000;

    let timeoutIdWarning = null;
    let timeoutIdEnd = null;
    let allReady = false;

    function liveRecv(data) {
        if (data.type === "go_to_next") {
            allReady = true;
            document.getElementById("warning-message").style.display = "none";
            document.getElementById("task_end_time_project").value = Date.now();
            form.submit();
        } else if (data.type === "waiting") {
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        document.getElementById("task_load_time_project").value = Date.now();

        const button = document.getElementById("nextbtn");
        const waitingMessage = document.getElementById("waiting-message");
        const warningMessage = document.getElementById("warning-message");

        function handleNextClick() {
            if (allReady) return;
            allReady = true;

            document.getElementById("task_finish_click_time_project").value = Date.now();
            button.disabled = true;
            button.style.backgroundColor = "#ccc";
            button.style.borderColor = "#ccc";
            button.style.color = "#666";
            button.style.cursor = "not-allowed";
            waitingMessage.style.display = "block";
            warningMessage.style.display = "none";
            liveSend({ type: "next_clicked" });

            clearTimeout(timeoutIdWarning);
            clearTimeout(timeoutIdEnd);
        }

        button.addEventListener("click", function (e) {
            e.preventDefault();
            handleNextClick();
        });

        timeoutIdWarning = setTimeout(() => {
            if (!allReady) {
                warningMessage.style.display = "block";
            }
        }, taskDuration - warningTime);

        timeoutIdEnd = setTimeout(() => {
            if (!allReady) {
                liveSend({ type: "next_clicked" });
            }
        }, taskDuration);
    });
</script>


{% endblock %}